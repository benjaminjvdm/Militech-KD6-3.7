# Plotly Figure Integration Plan

This plan outlines the steps to integrate the Plotly figure object generated by `app_finance/finance_charts.py` into the layout of the Dash application `main_suite_app.py` for display on the cash dashboard.

## Objective

Integrate a Plotly figure generated by `app_finance/finance_charts.py` into the Dash application `main_suite_app.py` for display on the cash dashboard, utilizing a `Plotter` class and converting the figure to a base64 encoded image for display in the existing HTML template.

## Plan Steps

1.  **Modify `app_finance/finance_charts.py`**:
    *   Create a new function, likely named `generate_dashboard_chart`, that takes a stock symbol as input.
    *   Move the chart generation logic (fetching data, calculating technicals, searching harmonics, and creating the Plotter object) into this function.
    *   Instead of calling `p.show()`, the function will return the generated Plotly figure object (`p.fig`).

2.  **Modify `main_suite_app.py`**:
    *   Update the `cash_dashboard()` route.
    *   Call the new `generate_dashboard_chart()` function from `app_finance.finance_charts` for the desired symbols (e.g., 'GBPJPY=X').
    *   For each returned Plotly figure, convert it to a base64 encoded image string (e.g., using `fig.to_image(format="png").decode("base64")`).
    *   Pass a dictionary of these base64 image strings (symbol as key, image data as value) to the `cash_dashboard.html` template.

3.  **Confirm Integration**:
    *   Ensure the `cash_dashboard.html` template correctly displays the base64 encoded images. (Based on the current template structure, this should work as is).

## Flow Diagram

```mermaid
graph TD
    A[User Request] --> B{main_suite_app.py};
    B --> C[cash_dashboard() route];
    C --> D{Call generate_dashboard_chart() for symbols};
    D --> E[app_finance/finance_charts.py];
    E --> F[generate_dashboard_chart(symbol)];
    F --> G[Generate Plotly Figure];
    G --> H[Return Plotly Figure Object];
    H --> D;
    D --> I[Convert Figure to Base64 Image];
    I --> J[Collect Images in Dictionary];
    J --> K[Render cash_dashboard.html];
    K --> L[Display Charts on Dashboard];